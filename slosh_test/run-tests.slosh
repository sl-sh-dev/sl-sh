#!/usr/bin/env slosh_test

(load "core.slosh")

(let (globals (get-globals-sorted)
      globals-len (len globals)
      i 0
      failing-tests {})
    (while (< i globals-len)
        (prn "Symbol: " globals.~i)
        (prn "===")
        (let (doc (doc-map globals.~i))
        ;; for some reason printing usage for vec-slice causes rust to panic with 'Handle 2045 is not a string!'
            (prn "Usage: " (str doc.:usage))
            (prn "Description: " (str doc.:description))
            (prn "Section: " (str doc.:section))
            (if (not (err? (get failing-tests (->key globals.~i))))
                (prn "~~~~~~~~~~~~~~~~~~~~~ Skipping failing test")
                (let (example (str doc.:example)
                              read-in (read-all example))
                    (prn "Example: " example)
                    (dotimes-i j (len read-in)
                        (let (line (prn (str read-in.~j))
                            evaled (eval read-in.~j))
                            (if (err? evaled)
                                (do (prn "Err: " (str evaled))
                                   (err (mk-err :test (str "Err: " evaled))))
                                (prn "Result: " (str evaled)))))))
        (prn "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX")
        (inc! i))))
